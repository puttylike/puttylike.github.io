{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/oracle-sql-기준이-다른-테이블-데이터-클렌징-하기/",
    "result": {"data":{"markdownRemark":{"html":"<p>어떤 data가 한 화면을 통해서 2개의 테이블에 동시에 입력되는데, 두 테이블의 기준이 되는 값이 (pk) 달랐다. 하나는 unique한 번호 기준이며, 다른 하나는 사람 (특정 관계자) 기준이다.</p>\n<p>어떤 컬럼에 숫자만 들어가야 하는데, 화면에 제어 로직이 없었어서 잘못된 데이터 타입이 들어가 있었다. 그래서 일괄적으로 default 값인 '00000'으로 업데이트를 진행하게 됐다. 또, 어떤 컬럼에는 한글이어야 하는데 값이 없는 경우가 있었다.</p>\n<p>그런데, 화면을 잘못 사용해서 같았던 데이터가 정합성 문제가 생겨 같은 데이터가 맞는지 판단히 애매한 경우 건들이 일부 있었다.</p>\n<p>두 테이블이 셋트이다 보니까, 같은 data가 맞다는 전제 하에 둘다 이상한 값이 들어간 경우에 한해서만 데이터 update를 하고 싶었다.</p>\n<p>결국, <strong>MERGE INTO 를 사용하여</strong> <u>두 테이블의 데이터가 일치한다고 판단되는</u> 건들 중 (WHEN MATCHED THEN만 사용), 둘다 잘못된 case를 '00000'로 일괄적으로 UPDATE 처리 했다.</p>\n<hr>\n<p>데이터 정합성 개선 작업 순서는 다음과 같다.</p>\n<p>[1] 두 테이블이 같은 건으로 확인되는데, 그럼에도 컬럼 값이 서로 다른 경우<br>\n=> 어쩔 수 없이 확인 후 건별로 데이터 수정 (전체 데이터의 0.01% 미만)</p>\n<p>[2] 두 테이블이 join이 가능한 경우</p>\n<ul>\n<li>A 테이블 작업 예시</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-sql line-numbers\"><code class=\"language-sql\"><span class=\"token keyword\">MERGE</span> <span class=\"token keyword\">INTO</span> A <span class=\"token keyword\">using</span><span class=\"token punctuation\">(</span>\r\n  <span class=\"token keyword\">SELECT</span> A<span class=\"token punctuation\">.</span>pk들 <span class=\"token keyword\">FROM</span> A <span class=\"token keyword\">join</span> B 테이블 <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token keyword\">WHERE</span> A<span class=\"token punctuation\">.</span>컬럼 <span class=\"token operator\">~</span> <span class=\"token punctuation\">)</span> AA\r\n  <span class=\"token keyword\">ON</span> {AA<span class=\"token punctuation\">.</span>pk들 <span class=\"token operator\">=</span> A<span class=\"token punctuation\">.</span>pk들 }\r\n  <span class=\"token keyword\">WHEN</span> <span class=\"token keyword\">MATCHED</span> <span class=\"token keyword\">THEN</span>\r\n  <span class=\"token keyword\">UPDATE</span>\r\n  <span class=\"token keyword\">SET</span> AA<span class=\"token punctuation\">.</span>컬럼<span class=\"token number\">2</span> <span class=\"token operator\">=</span> <span class=\"token string\">'미상'</span> <span class=\"token operator\">AND</span> AA<span class=\"token punctuation\">.</span>컬럼 <span class=\"token operator\">=</span> <span class=\"token string\">'00000'</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<ul>\n<li>B 테이블 작업 예시 (A와 B 데이터 갯수는 n:1이어서 distinct를 사용했다.)</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-sql line-numbers\"><code class=\"language-sql\"><span class=\"token keyword\">MERGE</span> <span class=\"token keyword\">INTO</span> B <span class=\"token keyword\">using</span><span class=\"token punctuation\">(</span>\r\n  <span class=\"token keyword\">SELECT</span> <span class=\"token keyword\">distinct</span> B<span class=\"token punctuation\">.</span>pk들 <span class=\"token keyword\">FROM</span> B <span class=\"token keyword\">join</span> A 테이블 <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token keyword\">WHERE</span> B<span class=\"token punctuation\">.</span>컬럼 <span class=\"token operator\">~</span> <span class=\"token punctuation\">)</span> BB\r\n   <span class=\"token keyword\">ON</span> {BB<span class=\"token punctuation\">.</span>pk들 <span class=\"token operator\">=</span> B<span class=\"token punctuation\">.</span>pk들 }\r\n   <span class=\"token keyword\">WHEN</span> <span class=\"token keyword\">MATCHED</span> <span class=\"token keyword\">THEN</span> \r\n   <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">SET</span> BB<span class=\"token punctuation\">.</span>컬럼<span class=\"token number\">2</span> <span class=\"token operator\">=</span> <span class=\"token string\">'미상'</span> BB<span class=\"token punctuation\">.</span>컬럼 <span class=\"token operator\">=</span> <span class=\"token string\">'00000'</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>=> 위 작업은 3번 반복되었다. 그냥 UPDATE 문으로 해도 된다지만, 두 테이블이 set이라서 같은 유형끼리 같은 시간에 수정되게 나눠서 진행했다. (...)</p>\n<ol>\n<li>두 컬럼 다 둘다 null인 경우</li>\n</ol>\n<p>ex)</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-sql line-numbers\"><code class=\"language-sql\"><span class=\"token keyword\">MERGE</span> <span class=\"token keyword\">INTO</span> <span class=\"token keyword\">TABLE</span> A\r\n<span class=\"token keyword\">USING</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">SELECT</span> A<span class=\"token punctuation\">.</span>pk들\r\n        <span class=\"token keyword\">FROM</span> A\r\n      <span class=\"token keyword\">INNER</span> <span class=\"token keyword\">JOIN</span> B\r\n        <span class=\"token keyword\">ON</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n<span class=\"token keyword\">WHERE</span> A<span class=\"token punctuation\">.</span>컬럼 <span class=\"token operator\">IS</span> <span class=\"token boolean\">NULL</span> <span class=\"token operator\">AND</span> A<span class=\"token punctuation\">.</span>컬럼<span class=\"token number\">2</span> <span class=\"token operator\">IS</span> <span class=\"token boolean\">NULL</span>\r\n  <span class=\"token operator\">AND</span> B<span class=\"token punctuation\">.</span>컬럼 <span class=\"token operator\">IS</span> <span class=\"token boolean\">NULL</span> <span class=\"token operator\">AND</span> B<span class=\"token punctuation\">.</span>컬럼<span class=\"token number\">2</span> <span class=\"token operator\">IS</span> <span class=\"token boolean\">NULL</span>\r\n        <span class=\"token punctuation\">)</span> AA\r\n<span class=\"token keyword\">ON</span> <span class=\"token punctuation\">(</span>A<span class=\"token punctuation\">.</span>pk들 <span class=\"token operator\">=</span> AA<span class=\"token punctuation\">.</span>pk들<span class=\"token punctuation\">)</span>\r\n<span class=\"token keyword\">WHEN</span> <span class=\"token keyword\">MATCHED</span> <span class=\"token keyword\">THEN</span>\r\n<span class=\"token keyword\">UPDATE</span>\r\n <span class=\"token keyword\">SET</span> AA<span class=\"token punctuation\">.</span>컬럼  <span class=\"token operator\">=</span> <span class=\"token string\">'asdfzxv35as!@5684e'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 고유식별번호라 00000의 복호화 값이 들어감</span>\r\n     AA<span class=\"token punctuation\">.</span>컬럼<span class=\"token number\">2</span> <span class=\"token operator\">=</span> <span class=\"token string\">'미상'</span>\r\n    <span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>ex)</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-sql line-numbers\"><code class=\"language-sql\"><span class=\"token keyword\">MERGE</span> <span class=\"token keyword\">INTO</span> <span class=\"token keyword\">TABLE</span> B\r\n<span class=\"token keyword\">USING</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">SELECT</span> <span class=\"token keyword\">distinct</span> B<span class=\"token punctuation\">.</span>pk들<span class=\"token punctuation\">,</span> A<span class=\"token punctuation\">.</span>컬럼<span class=\"token punctuation\">,</span> A<span class=\"token punctuation\">.</span>컬럼<span class=\"token number\">2</span>\r\n        <span class=\"token keyword\">FROM</span> B\r\n      <span class=\"token keyword\">INNER</span> <span class=\"token keyword\">JOIN</span> A\r\n        <span class=\"token keyword\">ON</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n<span class=\"token keyword\">WHERE</span> B<span class=\"token punctuation\">.</span>컬럼 <span class=\"token operator\">IS</span> <span class=\"token boolean\">NULL</span> <span class=\"token operator\">AND</span> B<span class=\"token punctuation\">.</span>컬럼<span class=\"token number\">2</span> <span class=\"token operator\">IS</span> <span class=\"token boolean\">NULL</span>\r\n  <span class=\"token operator\">AND</span> A<span class=\"token punctuation\">.</span>컬럼<span class=\"token operator\">=</span><span class=\"token string\">'미상'</span> <span class=\"token operator\">AND</span> A<span class=\"token punctuation\">.</span>컬럼<span class=\"token number\">2</span> <span class=\"token operator\">=</span> <span class=\"token string\">'asdfzxv35as!@5684e'</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span> 위에서 수정한 값\r\n        <span class=\"token punctuation\">)</span> AA\r\n<span class=\"token keyword\">ON</span> <span class=\"token punctuation\">(</span>B<span class=\"token punctuation\">.</span>pk들 <span class=\"token operator\">=</span> BB<span class=\"token punctuation\">.</span>pk들<span class=\"token punctuation\">)</span>\r\n<span class=\"token keyword\">WHEN</span> <span class=\"token keyword\">MATCHED</span> <span class=\"token keyword\">THEN</span>\r\n<span class=\"token keyword\">UPDATE</span>\r\n <span class=\"token keyword\">SET</span> BB<span class=\"token punctuation\">.</span>컬럼  <span class=\"token operator\">=</span> B<span class=\"token punctuation\">.</span>컬럼<span class=\"token punctuation\">,</span> <span class=\"token comment\">// A 테이블 (위에서 수정한) 값</span>\r\n     BB<span class=\"token punctuation\">.</span>컬럼<span class=\"token number\">2</span> <span class=\"token operator\">=</span> B<span class=\"token punctuation\">.</span>컬럼<span class=\"token number\">2</span> <span class=\"token comment\">// A 테이블 (위에서 수정한) 값</span>\r\n    <span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<ol start=\"2\">\n<li>컬럼2가 null 인 경우</li>\n<li>컬럼이 null인 경우</li>\n</ol>\n<p>[3] 두 테이블이 join 되지 않는 건\r\n=> 각각 update 쿼리 사용 (전체 데이터의 0.1% 미만)</p>\n<p>** 이미지 파일을 건별로 확인하는 게 오래 걸려서 더 이상 수정은 불가했다.</p>","tableOfContents":"","frontmatter":{"title":"데이터 클렌징 작업 - 정합성 개선 (by SQL Merge Into 구문)"}}},"pageContext":{"slug":"/oracle-sql-기준이-다른-테이블-데이터-클렌징-하기/"}},
    "staticQueryHashes": ["3159585216"]}